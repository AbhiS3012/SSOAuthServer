<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>SSO Login</title>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- Font Awesome for icons -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
	rel="stylesheet">

<style>
b, strong {
	font-weight: normal;
	font-size: small;
	font-family: "Roboto", sans-serif;
}

.showPass {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #9ca3af;
}

/*//////////////////////////////////////////////////////////////////
[ Utility ]*/
.txt1 {
	font-family: Poppins-Regular;
	font-size: 13px;
	line-height: 1.5;
	color: #999999;
}

.txt2 {
	font-family: Poppins-Regular;
	font-size: 13px;
	line-height: 1.5;
	color: #666666;
}

/*//////////////////////////////////////////////////////////////////
[ login ]*/
.limiter {
	width: 100%;
	margin: 0 auto;
}

.container-login100 {
	width: 100%;
	min-height: 100vh;
	display: -webkit-box;
	display: -webkit-flex;
	display: -moz-box;
	display: -ms-flexbox;
	display: flex;
	flex-wrap: wrap;
	justify-content: center;
	align-items: center;
	padding: 15px;
	background: linear-gradient(135deg, #f4f8ff 0%, #eef4ff 40%, #ffffff 100%);
}

.wrap-login100 {
	width: 860px;
	background: #fff;
	border-radius: 10px;
	overflow: hidden;
	display: -webkit-box;
	display: -webkit-flex;
	display: -moz-box;
	display: -ms-flexbox;
	display: flex;
    justify-content: center; 
    padding: 32px 48px;
    gap: 32px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
}

/*------------------------------------------------------------------
[  ]*/
.login100-pic {
    display: flex;
    align-items: center;
    justify-content: center;
}

.logoImage {
    max-width: 100%;
    height: auto;
}

/*------------------------------------------------------------------
[  ]*/
.login100-form-title {
	font-family: Poppins-Bold;
	font-size: 26px;
    font-weight: 600;
    color: #1f2937;
	line-height: 1.2;
	text-align: center;
	letter-spacing: 0.4px;
	width: 100%;
	display: block;
}

.login100-form-title::after {
    content: "";
    display: block;
    width: 48px;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
    margin: 12px auto 0;
    border-radius: 2px;
}

/*---------------------------------------------*/
.wrap-input100 {
	position: relative;
	width: 100%;
	z-index: 1;
	margin-bottom: 10px;
}

.input100 {
	font-family: Poppins-Medium;
	font-size: 15px;
	width: 100%;
    border: 1px solid #e5e7eb;
	background: #f9fafb;
	height: 52px;
    border-radius: 14px;
    padding-left: 64px;
    transition: all 0.25s ease;
}

/*------------------------------------------------------------------
[ Focus ]*/
.input100:focus {
    background: #ffffff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
}

.input100:focus+.focus-input100+.symbol-input100 {
	color: #3b82f6;
}

.symbol-input100 {
	font-size: 15px;
	display: flex;
	align-items: center;
	position: absolute;
	border-radius: 25px;
	bottom: 0;
	left: 0;
	width: 100%;
	height: 100%;
	padding-left: 35px;
	pointer-events: none;
	color: #9ca3af;
	-webkit-transition: all 0.4s;
	-o-transition: all 0.4s;
	-moz-transition: all 0.4s;
	transition: all 0.4s;
}

.input100:focus+.focus-input100 {
	-webkit-animation: anim-shadow 0.5s ease-in-out forwards;
	animation: anim-shadow 0.5s ease-in-out forwards;
}

@-webkit-keyframes anim-shadow {to { box-shadow:0px0px70px25px;
	opacity: 0;
}

}
@keyframes anim-shadow {to { box-shadow:0px0px70px25px;
	opacity: 0;
}

}

/*------------------------------------------------------------------
[ Button ]*/
.container-login100-form-btn {
	width: 100%;
	display: -webkit-box;
	display: -webkit-flex;
	display: -moz-box;
	display: -ms-flexbox;
	display: flex;
	flex-wrap: wrap;
	justify-content: center;
}

.login100-form-btn {
	font-family: Poppins-Bold;
	font-size: 15px;
	font-weight: 600;
    letter-spacing: 0.5px;
	line-height: 1.5;
	color: #fff;
	text-transform: uppercase;
	width: 100%;
	height: 52px;
	border-radius: 14px;
    background: linear-gradient(135deg, #3b82f6, #2563eb);
	display: -webkit-box;
	display: -webkit-flex;
	display: -moz-box;
	display: -ms-flexbox;
	display: flex;
	justify-content: center;
	align-items: center;
	padding: 0 25px;
	-webkit-transition: all 0.4s;
	-o-transition: all 0.4s;
	-moz-transition: all 0.4s;
	transition: all 0.4s;
}

.login100-form-btn:hover {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
}

/*------------------------------------------------------------------
[ Alert validate ]*/
.validate-input {
	position: relative;
}

.alert-validate::before {
	content: attr(data-validate);
	position: absolute;
	max-width: 70%;
	background-color: white;
	border: 1px solid #c80000;
	border-radius: 13px;
	padding: 4px 25px 4px 10px;
	top: 50%;
	-webkit-transform: translateY(-50%);
	-moz-transform: translateY(-50%);
	-ms-transform: translateY(-50%);
	-o-transform: translateY(-50%);
	transform: translateY(-50%);
	right: 8px;
	pointer-events: none;
	font-family: Poppins-Medium;
	color: #c80000;
	font-size: 13px;
	line-height: 1.4;
	text-align: left;
	visibility: hidden;
	opacity: 0;
	-webkit-transition: opacity 0.4s;
	-o-transition: opacity 0.4s;
	-moz-transition: opacity 0.4s;
	transition: opacity 0.4s;
}

.alert-validate::after {
	content: "\f06a";
	font-family: "FontAwesome";
	display: block;
	position: absolute;
	color: #c80000;
	font-size: 15px;
	top: 50%;
	-webkit-transform: translateY(-50%);
	-moz-transform: translateY(-50%);
	-ms-transform: translateY(-50%);
	-o-transform: translateY(-50%);
	transform: translateY(-50%);
	right: 13px;
}

.alert-validate:hover:before {
	visibility: visible;
	opacity: 1;
}

.wrap-login200 {
	width: 380px;
	background: #fff;
	border-radius: 16px;
	padding: 15px 15px 43px 25px;
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.08),
        0 4px 12px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.wrap-login200:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 28px 60px rgba(0, 0, 0, 0.12),
        0 6px 18px rgba(0, 0, 0, 0.08);
}

.modal-content .modal-header, .modal-content .modal-footer {
	border-color: #eaf0f9;
	background-color: #eaf0f9;
}

.close:active, .close:focus {
	outline: none;
}

.disabled {
	pointer-events: none;
	opacity: 0.6;
}

.captchaView {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.logindetails {
    flex: 0.9;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20x;
}

/* After login message */
#loginMessage {
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Poppins', sans-serif;
}

.login-text {
    font-size: 1.5rem;
    color: #000;
}

.login-username {
    color: #22c55e;
}

.signedIn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 2.2rem;
    height: 2.2rem;
    border-radius: 50%;
    background-color: #22c55e;
    color: white;
    font-size: 1.2rem;
    margin-left: 0.8rem;
    transform: scale(0);
    animation: popIn 0.5s forwards;
}

@keyframes popIn {
    0% { transform: scale(0); }
    60% { transform: scale(1.3); }
    100% { transform: scale(1); }
}
</style>

</head>
<body>

	<div class="limiter">
		<div class="container-login100">

			<div class="wrap-login100">
				<div class="logindetails">
					<div class="login100-pic js-tilt" data-tilt="">
						<img th:src="@{/images/SSOLogo.png}" alt="SSO Logo"
							class="logoImage">
					</div>
				</div>

				<div class="logindetails2" style="margin-top: 0px;">
					<div class="wrap-login200" style="margin-top: 0px;">

						<form th:action="@{/api/auth/login}" id="loginForm"
							class="form-horizontal auth-form" method="post">
							<span class="login100-form-title">Sign In </span>
							<div class="active p-3" id="loginform" role="tabpanel">
								<p style="color: red; text-align: center">
									<b><span></span></b>
								</p>

								<div class="wrap-input100 ">
									<input class="input100 form control" type="text"
										name="username" placeholder="Enter Username"> <span
										class="focus-input100"></span> <span class="symbol-input100">
										<i class="fa fa-user" aria-hidden="true"></i>
									</span>
								</div>

								<div class="wrap-input100 validate-input"
									data-validate="Password is required">
									<input class="input100" type="password" name="password"
										id="password" placeholder="Enter Password"> <span
										class="focus-input100"></span> <span class="symbol-input100">
										<i class="fa fa-lock" aria-hidden="true"></i>
									</span> <i onclick="confirmP()" class="fa fa-eye showPass"></i>
								</div>

								<div class="input-group captchaView">
									<div class="g-recaptcha"
										data-sitekey="6LcbeokrAAAAAJ-45kSOAgmKbuZkILXZ37kSnbz8">
									</div>
								</div>

								<div class="container-login100-form-btn">
									<button class="login100-form-btn" type="submit">Login</button>
								</div>
							</div>
						</form>
						<div id="loginMessage"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--end container-->

	<!-- Error Modal -->
	<div id="errorMsg" class="modal fade" role="dialog">
		<div class="modal-dialog modal-sm">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<h4 style="color: red;">
						<!-- <img src="static/assets/img/errorNew.webp" height="30" width="30"> -->
						<span class="blink_me headingMsg"></span>
					</h4>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-sm-12">
							<div class="msg" style="font-size: 18px;"></div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-bs-dismiss="modal" onclick="window.location.reload();">Ok</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
	
	<script>
		function confirmP() {
			var x = document.getElementById("password");
			if (x.type === "password") {
				x.type = "text";
			} else {
				x.type = "password";
			}
		}
	</script>
	
<script th:inline="javascript">
    const LOGIN_URL = /*[[ @{/api/auth/login} ]]*/ "";
</script>
	
<script>
document.addEventListener("DOMContentLoaded", () => {

    const loginForm = document.getElementById("loginForm");
    const loginMessage = document.getElementById("loginMessage");
    const errorModal = document.getElementById("errorMsg");

    /* -------------------------------
       Unauthorized param handler
    -------------------------------- */
    const params = new URLSearchParams(window.location.search);
    if (params.has("unauthorized")) {
        showError(
            "Unauthorized User",
            `Invalid Credentials: ${params.get("unauthorized")}`
        );
    }

    /* -------------------------------
       Form submit handler
    -------------------------------- */
    loginForm?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const payload = {
                username: loginForm.username.value,
                password: loginForm.password.value,
                captchToken: grecaptcha.getResponse()
            };
        
        const submitBtn = loginForm.querySelector("button[type='submit']");
        submitBtn.disabled = true;
        submitBtn.textContent = "Signing in...";
        
        try {
            const response = await fetch(LOGIN_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                let errorBody = {};
                try {
                    errorBody = await response.json();
                } catch (_) {}

                throw {
                    title: errorBody.error || "Login Failed",
                    message: errorBody.exceptionMsg || "Authentication error",
                    status: response.status
                };
            }

            loginForm.style.display = "none";
            loginMessage.innerHTML = `
                <div style="display:flex; align-items:center;">
                    <span class="login-text">
                        Signed in as <span class="login-username">${payload.username}</span>
                    </span>
                    <i class="fa fa-check signedIn"></i>
                </div>
            `;

            const redirect = params.get("redirect");
            if (redirect) {
                window.location.href = redirect;
            }

        } catch (err) {
            showErrorModal(
                    err.title || "Error",
                    err.message || "Unexpected error occurred"
                );
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "Login";
        }
    });

    /* -------------------------------
       Error modal helper
    -------------------------------- */
    function showErrorModal(title, message) {
        const modalEl = document.getElementById("errorMsg");
        
        modalEl.querySelector(".headingMsg").textContent = title;
        modalEl.querySelector(".msg").textContent = message;

        const modal = new bootstrap.Modal(modalEl, {
            backdrop: "static",
            keyboard: false
        });

        modal.show();
    }

});
</script>

</body>
</html>
